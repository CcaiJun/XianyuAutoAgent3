# ğŸª Cookieè‡ªåŠ¨æ›´æ–°åŠŸèƒ½è¯´æ˜

## ğŸ“‹ åŠŸèƒ½æ¦‚è¿°

æœ¬é¡¹ç›®æ–°å¢äº†**è‡ªåŠ¨æ›´æ–°.envæ–‡ä»¶ä¸­COOKIES_STR**çš„åŠŸèƒ½ï¼Œæœ‰æ•ˆè§£å†³äº†é—²é±¼Sessionä¼šè¯è¿‡æœŸé—®é¢˜ï¼Œå¤§å¤§å»¶é•¿äº†cookieçš„æœ‰æ•ˆæœŸã€‚

### ğŸ¯ æ ¸å¿ƒç‰¹æ€§

- âœ… **è‡ªåŠ¨Cookieæ¸…ç†** - æ¸…é™¤é‡å¤çš„cookieé¡¹ï¼Œä¿æŒcookieçš„æ•´æ´æ€§
- âœ… **æ™ºèƒ½.envæ›´æ–°** - è‡ªåŠ¨å°†æ›´æ–°åçš„cookieåŒæ­¥åˆ°ç¯å¢ƒé…ç½®æ–‡ä»¶
- âœ… **Cookieå®Œæ•´æ€§éªŒè¯** - æ£€æŸ¥å¿…éœ€çš„cookieå­—æ®µæ˜¯å¦å®Œæ•´
- âœ… **æ–°é²œåº¦æ£€æµ‹** - æ ¹æ®æ—¶é—´æˆ³åˆ¤æ–­cookieçš„æ–°é²œç¨‹åº¦
- âœ… **å®‰å…¨å¤‡ä»½æœºåˆ¶** - æ›´æ–°å‰è‡ªåŠ¨å¤‡ä»½.envæ–‡ä»¶
- âœ… **å‘½ä»¤è¡Œç®¡ç†å·¥å…·** - æä¾›ä¾¿æ·çš„cookieç®¡ç†ç•Œé¢

## ğŸ”§ æŠ€æœ¯å®ç°

### è‡ªåŠ¨è§¦å‘æœºåˆ¶

ç³»ç»Ÿåœ¨ä»¥ä¸‹æƒ…å†µä¸‹ä¼šè‡ªåŠ¨æ›´æ–°cookieï¼š

1. **APIå“åº”åŒ…å«Set-Cookieå¤´** - æœåŠ¡å™¨è¿”å›æ–°cookieæ—¶
2. **ç™»å½•çŠ¶æ€éªŒè¯æˆåŠŸå** - é‡æ–°ç™»å½•æ—¶è·å–åˆ°æ–°cookie
3. **Tokenåˆ·æ–°æ—¶** - è·å–æ–°tokenè¿‡ç¨‹ä¸­æ›´æ–°cookie
4. **æ¸…ç†é‡å¤cookieå** - æ¸…ç†æ“ä½œå®Œæˆåè‡ªåŠ¨ä¿å­˜

### æ ¸å¿ƒä»£ç è·¯å¾„

```
apis/xianyu_apis.py         # ä¸»è¦çš„è‡ªåŠ¨æ›´æ–°é€»è¾‘
utils/cookie_utils.py       # Cookieå¤„ç†å·¥å…·å‡½æ•°
scripts/cookie_manager.py   # å‘½ä»¤è¡Œç®¡ç†å·¥å…·
```

## ğŸ“š ä½¿ç”¨æ–¹æ³•

### 1. è‡ªåŠ¨æ›´æ–°ï¼ˆæ— éœ€æ‰‹åŠ¨æ“ä½œï¼‰

ç³»ç»Ÿä¼šåœ¨è¿è¡Œè¿‡ç¨‹ä¸­è‡ªåŠ¨å¤„ç†cookieæ›´æ–°ï¼š

```python
# åœ¨APIè°ƒç”¨ä¸­è‡ªåŠ¨è§¦å‘
api_client = XianyuAPIClient()
api_client.validate_login_status()  # è‡ªåŠ¨æ›´æ–°cookie
```

æ—¥å¿—è¾“å‡ºç¤ºä¾‹ï¼š
```
[INFO] âœ… å·²è‡ªåŠ¨æ›´æ–°.envæ–‡ä»¶ä¸­çš„COOKIES_STR (15 ä¸ªcookies)
[INFO] ğŸ•’ Cookieå¹´é¾„: 2.35å°æ—¶ (æ–°é²œ)
```

### 2. å‘½ä»¤è¡Œç®¡ç†å·¥å…·

#### å®‰è£…ä½¿ç”¨

```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd /path/to/XianyuAutoAgent2

# ç»™è„šæœ¬æ‰§è¡Œæƒé™
chmod +x scripts/cookie_manager.py

# æŸ¥çœ‹å¸®åŠ©
python scripts/cookie_manager.py --help
```

#### å¸¸ç”¨å‘½ä»¤

**æŸ¥çœ‹CookieçŠ¶æ€ï¼š**
```bash
python scripts/cookie_manager.py status
```

è¾“å‡ºç¤ºä¾‹ï¼š
```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘              ğŸª é—²é±¼Cookieç®¡ç†å·¥å…·                      â•‘
â•‘          æ™ºèƒ½é—²é±¼å®¢æœæœºå™¨äººç³»ç»Ÿ - Cookieç®¡ç†å™¨            â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“Š CookieçŠ¶æ€æ£€æŸ¥...

ğŸ” CookieçŠ¶æ€æŠ¥å‘Š:
  Cookieæ•°é‡: 15
  å®Œæ•´æ€§: âœ… å®Œæ•´
  æ–°é²œåº¦: âœ… æ–°é²œ
  Cookieå¹´é¾„: 3.25å°æ—¶
  ç”¨æˆ·ID: 1234567890
  æœ‰Token: âœ…
  æœ‰ä¼šè¯: âœ…

ğŸ¯ Cookieå¥åº·åº¦: 85/100
âœ… CookieçŠ¶æ€è‰¯å¥½
```

**äº¤äº’å¼æ›´æ–°Cookieï¼š**
```bash
python scripts/cookie_manager.py update
```

**ä»æ–‡ä»¶æ›´æ–°Cookieï¼š**
```bash
python scripts/cookie_manager.py update -f cookies.txt
```

**ç›´æ¥æŒ‡å®šCookieæ›´æ–°ï¼š**
```bash
python scripts/cookie_manager.py update -c "unb=1234567890; _m_h5_tk=token_value"
```

**éªŒè¯Cookieæ ¼å¼ï¼š**
```bash
python scripts/cookie_manager.py validate -c "your_cookie_string"
```

**å¤‡ä»½.envæ–‡ä»¶ï¼š**
```bash
python scripts/cookie_manager.py backup
```

### 3. ç¨‹åºå†…APIè°ƒç”¨

```python
from utils.cookie_utils import (
    update_env_cookies_safely,
    get_cookie_status_report,
    validate_cookie_completeness
)

# å®‰å…¨æ›´æ–°cookie
success = update_env_cookies_safely(cookie_string, create_backup=True)

# è·å–cookieçŠ¶æ€æŠ¥å‘Š
report = get_cookie_status_report(cookie_string)
print(f"Cookieå¥åº·åº¦: {report['is_complete']} & {report['is_fresh']}")
```

## ğŸ” CookieéªŒè¯æ ‡å‡†

### å¿…éœ€å­—æ®µï¼ˆç¼ºå¤±å°†å½±å“åŠŸèƒ½ï¼‰
- `unb` - ç”¨æˆ·å”¯ä¸€æ ‡è¯†
- `_m_h5_tk` - H5 Tokenï¼ˆç”¨äºAPIç­¾åï¼‰
- `cookie2` - ä¼šè¯æ ‡è¯†
- `cna` - å®¢æˆ·ç«¯æ ‡è¯†
- `sgcookie` - å®‰å…¨Cookie

### é‡è¦å­—æ®µï¼ˆå»ºè®®åŒ…å«ï¼‰
- `x` - æ‰©å±•ä¿¡æ¯
- `t` - æ—¶é—´æˆ³
- `tracknick` - ç”¨æˆ·æ˜µç§°
- `XSRF-TOKEN` - CSRFä¿æŠ¤

### æ–°é²œåº¦åˆ¤æ–­
- **æ–°é²œ** - Cookieå¹´é¾„ < 24å°æ—¶
- **å¯èƒ½è¿‡æœŸ** - Cookieå¹´é¾„ â‰¥ 24å°æ—¶

## ğŸ“ æ–‡ä»¶ç»“æ„

```
é¡¹ç›®æ ¹ç›®å½•/
â”œâ”€â”€ .env                          # ç¯å¢ƒé…ç½®æ–‡ä»¶ï¼ˆåŒ…å«COOKIES_STRï¼‰
â”œâ”€â”€ .env.backup.{timestamp}       # è‡ªåŠ¨å¤‡ä»½æ–‡ä»¶
â”œâ”€â”€ apis/
â”‚   â””â”€â”€ xianyu_apis.py           # Cookieè‡ªåŠ¨æ›´æ–°æ ¸å¿ƒé€»è¾‘
â”œâ”€â”€ utils/
â”‚   â””â”€â”€ cookie_utils.py          # Cookieå¤„ç†å·¥å…·å‡½æ•°
â”œâ”€â”€ scripts/
â”‚   â””â”€â”€ cookie_manager.py        # å‘½ä»¤è¡Œç®¡ç†å·¥å…·
â””â”€â”€ docs/
    â””â”€â”€ COOKIE_MANAGEMENT.md     # æœ¬æ–‡æ¡£
```

## ğŸ›¡ï¸ å®‰å…¨ç‰¹æ€§

### 1. è‡ªåŠ¨å¤‡ä»½
- æ¯æ¬¡æ›´æ–°å‰è‡ªåŠ¨åˆ›å»º.envæ–‡ä»¶å¤‡ä»½
- å¤‡ä»½æ–‡ä»¶åŒ…å«æ—¶é—´æˆ³ï¼Œä¾¿äºæ¢å¤
- è‡ªåŠ¨æ¸…ç†è¿‡æœŸå¤‡ä»½ï¼ˆé»˜è®¤ä¿ç•™5ä¸ªï¼‰

### 2. æ ¼å¼éªŒè¯
- è§£æcookieå­—ç¬¦ä¸²å‰è¿›è¡Œæ ¼å¼æ£€æŸ¥
- éªŒè¯å¿…éœ€å­—æ®µçš„å®Œæ•´æ€§
- ç‰¹æ®Šå­—ç¬¦è‡ªåŠ¨è½¬ä¹‰å¤„ç†

### 3. é”™è¯¯å¤„ç†
- æ–‡ä»¶æƒé™æ£€æŸ¥
- å¼‚å¸¸æƒ…å†µä¼˜é›…é™çº§
- è¯¦ç»†çš„é”™è¯¯æ—¥å¿—è®°å½•

### 4. è·¯å¾„æœç´¢
æŒ‰ä¼˜å…ˆçº§æœç´¢.envæ–‡ä»¶ï¼š
1. å½“å‰å·¥ä½œç›®å½•
2. é¡¹ç›®æ ¹ç›®å½•
3. ç”¨æˆ·ä¸»ç›®å½•

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### 1. å¢é‡æ›´æ–°
- åªåœ¨cookieå®é™…å˜åŒ–æ—¶æ‰å†™å…¥æ–‡ä»¶
- é¿å…ä¸å¿…è¦çš„ç£ç›˜I/Oæ“ä½œ

### 2. æ™ºèƒ½è§¦å‘
- ä»…åœ¨APIå“åº”åŒ…å«æ–°cookieæ—¶è§¦å‘æ›´æ–°
- é¿å…é¢‘ç¹çš„æ–‡ä»¶æ“ä½œ

### 3. å†…å­˜ç¼“å­˜
- Sessionå¯¹è±¡ä¸­ç¼“å­˜cookieçŠ¶æ€
- å‡å°‘é‡å¤çš„è§£ææ“ä½œ

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

**1. .envæ–‡ä»¶æ‰¾ä¸åˆ°**
```bash
âŒ æ— æ³•æ‰¾åˆ°.envæ–‡ä»¶
```
è§£å†³æ–¹æ¡ˆï¼šç¡®ä¿.envæ–‡ä»¶å­˜åœ¨äºé¡¹ç›®æ ¹ç›®å½•æˆ–å½“å‰ç›®å½•

**2. æƒé™ä¸è¶³**
```bash
âŒ æ²¡æœ‰æƒé™å†™å…¥.envæ–‡ä»¶
```
è§£å†³æ–¹æ¡ˆï¼šæ£€æŸ¥æ–‡ä»¶æƒé™ `chmod 644 .env`

**3. Cookieæ ¼å¼é”™è¯¯**
```bash
âŒ Cookieä¸å®Œæ•´ï¼Œç¼ºå°‘å­—æ®µ: ['unb', '_m_h5_tk']
```
è§£å†³æ–¹æ¡ˆï¼šä»æµè§ˆå™¨é‡æ–°è·å–å®Œæ•´çš„cookieå­—ç¬¦ä¸²

**4. Cookieè¿‡æœŸ**
```bash
âš ï¸ Cookieå¹´é¾„: 36.50å°æ—¶ (å¯èƒ½è¿‡æœŸ)
```
è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨æ–°çš„cookieå­—ç¬¦ä¸²æ›´æ–°

### æ—¥å¿—æŸ¥çœ‹

```bash
# æŸ¥çœ‹cookieç›¸å…³æ—¥å¿—
tail -f logs/api_xianyu.log | grep -i cookie

# æŸ¥çœ‹ç³»ç»Ÿæ•´ä½“æ—¥å¿—
tail -f main.log
```

## ğŸš€ å‡çº§è¯´æ˜

### ä»æ—§ç‰ˆæœ¬å‡çº§

å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯æ—§ç‰ˆæœ¬çš„XianyuApis.pyï¼Œå»ºè®®è¿ç§»åˆ°æ–°çš„æ¨¡å—åŒ–æ¶æ„ï¼š

1. æ–°çš„APIå®¢æˆ·ç«¯ä½äº `apis/xianyu_apis.py`
2. Cookieå·¥å…·å‡½æ•°ä½äº `utils/cookie_utils.py`
3. ç®¡ç†å·¥å…·ä½äº `scripts/cookie_manager.py`

### é…ç½®è¿ç§»

æ—§ç‰ˆæœ¬çš„é…ç½®ä¼šè‡ªåŠ¨å…¼å®¹ï¼Œæ— éœ€æ‰‹åŠ¨è¿ç§»ã€‚

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœæ‚¨åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼š

1. æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶ç¡®å®šå…·ä½“é”™è¯¯
2. ä½¿ç”¨ `python scripts/cookie_manager.py validate` æ£€æŸ¥cookieæ ¼å¼
3. ä½¿ç”¨ `python scripts/cookie_manager.py status` æŸ¥çœ‹æ•´ä½“çŠ¶æ€
4. æäº¤Issueæ—¶è¯·é™„ä¸Šç›¸å…³æ—¥å¿—ä¿¡æ¯

---

**ç‰ˆæœ¬ä¿¡æ¯ï¼š** v2.0
**æ›´æ–°æ—¥æœŸï¼š** 2024å¹´
**ç»´æŠ¤è€…ï¼š** XianyuAutoAgentå¼€å‘å›¢é˜Ÿ 